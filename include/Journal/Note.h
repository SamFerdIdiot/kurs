#ifndef JOURNAL_NOTE_H
#define JOURNAL_NOTE_H

#include <string>
#include <vector>
#include <functional>
#include <memory>
#include <SFML/Graphics.hpp>

// Forward declarations
class PlayerState;

/**
 * @brief NoteChoice - –≤—ã–±–æ—Ä –≤ –∑–∞–ø–∏—Å–∫–µ
 *
 * –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –∏–≥—Ä–æ–∫.
 * –°–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç –≤—ã–±–æ—Ä–∞, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ.
 */
struct NoteChoice {
    std::string text;                                    // –¢–µ–∫—Å—Ç –≤—ã–±–æ—Ä–∞: "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∏ –ø–æ–º–æ—á—å"
    std::string outcomeText;                             // –¢–µ–∫—Å—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: "–í—ã –ø–æ–º–æ–≥–ª–∏..."
    std::function<void(PlayerState*)> action;            // –î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ

    // –£—Å–ª–æ–≤–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    std::function<bool(PlayerState*)> condition;         // nullptr = –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω

    // –í–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
    bool isDisabled;                                     // –°–µ—Ä—ã–π —Ü–≤–µ—Ç, –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    std::string disabledReason;                          // "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥"

    NoteChoice()
        : action(nullptr), condition(nullptr), isDisabled(false) {}

    NoteChoice(const std::string& t, const std::string& outcome,
               std::function<void(PlayerState*)> act)
        : text(t), outcomeText(outcome), action(act),
          condition(nullptr), isDisabled(false) {}
};

/**
 * @brief Note - –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø–∏—Å–æ–∫ –≤ –∂—É—Ä–Ω–∞–ª–µ
 *
 * –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø–∏—Å–æ–∫:
 * - CityNote (–≥–æ—Ä–æ–¥)
 * - TravelNote (–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ)
 * - EventNote (—Å–æ–±—ã—Ç–∏–µ)
 * - LocationNote (–ª–æ–∫–∞—Ü–∏—è: –∑–∞–ø—Ä–∞–≤–∫–∞, –º–æ—Ç–µ–ª—å –∏ —Ç.–¥.)
 *
 * –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å–∫–∞ –∏–º–µ–µ—Ç:
 * - –ó–∞–≥–æ–ª–æ–≤–æ–∫ (title)
 * - –û–ø–∏—Å–∞–Ω–∏–µ (description)
 * - –í–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–±–æ—Ä–∞ (choices)
 * - –ú–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–±–æ—Ä–∞ (executeChoice)
 */
class Note {
public:
    enum class Type {
        CITY,       // –ó–∞–ø–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–∞ (–≤—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏–π –≤ –≥–æ—Ä–æ–¥–µ)
        TRAVEL,     // –ó–∞–ø–∏—Å–∫–∞ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è (–¥–æ—Ä–æ–≥–∞ –º–µ–∂–¥—É –≥–æ—Ä–æ–¥–∞–º–∏)
        EVENT,      // –°–æ–±—ã—Ç–∏–π–Ω–∞—è –∑–∞–ø–∏—Å–∫–∞ (—Å–ª—É—á–∞–π–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ)
        LOCATION    // –ó–∞–ø–∏—Å–∫–∞ –ª–æ–∫–∞—Ü–∏–∏ (–∑–∞–ø—Ä–∞–≤–∫–∞, –º–æ—Ç–µ–ª—å, —Ä–∞–±–æ—Ç–∞ –∏ —Ç.–¥.)
    };

    virtual ~Note() = default;

    // === –û–°–ù–û–í–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø ===

    /**
     * @brief –ü–æ–ª—É—á–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–ø–∏—Å–∫–∏
     * @return –ó–∞–≥–æ–ª–æ–≤–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "üìç –ú–û–°–ö–í–ê" –∏–ª–∏ "‚ö° –°–û–ë–´–¢–ò–ï: –°–ª–æ–º–∞–Ω–Ω–∞—è –º–∞—à–∏–Ω–∞")
     */
    virtual std::string getTitle() const = 0;

    /**
     * @brief –ü–æ–ª—É—á–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∫–∏
     * @return –¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è (–º–æ–∂–µ—Ç –±—ã—Ç—å –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–º)
     */
    virtual std::string getDescription() const = 0;

    /**
     * @brief –ü–æ–ª—É—á–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–±–æ—Ä–∞
     * @return –í–µ–∫—Ç–æ—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–≤
     */
    virtual std::vector<NoteChoice> getChoices() const = 0;

    /**
     * @brief –ü–æ–ª—É—á–∏—Ç—å —Ç–∏–ø –∑–∞–ø–∏—Å–∫–∏
     * @return –¢–∏–ø (CITY, TRAVEL, EVENT, LOCATION)
     */
    virtual Type getType() const = 0;

    // === –û–ë–†–ê–ë–û–¢–ö–ê –í–´–ë–û–†–ê ===

    /**
     * @brief –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞
     * @param choiceIndex –ò–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (0-N)
     * @param playerState –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
     */
    virtual void executeChoice(int choiceIndex, PlayerState* playerState) = 0;

    // === –û–ë–ù–û–í–õ–ï–ù–ò–ï (–¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø–∏—Å–æ–∫) ===

    /**
     * @brief –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–ø–∏—Å–∫–∏ (–¥–ª—è TravelNote —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º)
     * @param deltaTime –í—Ä–µ–º—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã)
     */
    virtual void update(float deltaTime) {
        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º (—Å—Ç–∞—Ç–∏—á–Ω—ã–µ –∑–∞–ø–∏—Å–∫–∏)
    }

    // === –†–ï–ù–î–ï–†–ò–ù–ì ===

    /**
     * @brief –û—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å–∫—É (–±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
     * @param window –û–∫–Ω–æ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
     * @param font –®—Ä–∏—Ñ—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞
     * @param selectedChoiceIndex –ò–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (-1 –µ—Å–ª–∏ –Ω–µ—Ç)
     */
    virtual void render(sf::RenderWindow& window, const sf::Font& font,
                       int selectedChoiceIndex = -1);

    // === –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–û–î–´ ===

    /**
     * @brief –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ª–∏ –∑–∞–ø–∏—Å–∫–∞
     * @return true –µ—Å–ª–∏ –∑–∞–ø–∏—Å–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–π
     */
    virtual bool isFinished() const { return m_isFinished; }

    /**
     * @brief –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–ø–∏—Å–∫—É –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é
     */
    void setFinished(bool finished) { m_isFinished = finished; }

    /**
     * @brief –ü–æ–ª—É—á–∏—Ç—å ID –∑–∞–ø–∏—Å–∫–∏ (–¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏)
     */
    std::string getId() const { return m_id; }

protected:
    std::string m_id;                   // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞–ø–∏—Å–∫–∏
    bool m_isFinished;                  // –ó–∞–≤–µ—Ä—à–µ–Ω–∞ –ª–∏ –∑–∞–ø–∏—Å–∫–∞

    Note(const std::string& id) : m_id(id), m_isFinished(false) {}
};

#endif // JOURNAL_NOTE_H
