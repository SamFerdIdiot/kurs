# Шаблон Промпта для Пользовательских Агентов

**Краткое описание:** Канонический шаблон и руководство по написанию и поддержке строгих промт-шаблонов для пользовательских агентов проекта Road Trip Adventure RPG.

---

## Цель и область применения / Purpose and Scope

Этот документ определяет **стандарт для создания и поддержки промптов** для пользовательских агентов в проекте.

**Зачем это нужно:**
- Обеспечение единообразия в формулировках задач для агентов
- Снижение количества ошибок при интерпретации требований
- Упрощение тестирования и отладки работы агентов
- Централизация лучших практик написания промптов

**Что покрывает:**
- Структура промпт-файлов (YAML и Markdown)
- Строгий режим валидации промптов
- Параметры и плейсхолдеры
- Интеграция с CI/CD и скриптами агентов
- Правила версионирования и обратной совместимости

---

## Резюме / Ключевые моменты

- ✅ **Единый формат**: Все промпты следуют структуре YAML + Markdown
- ✅ **Строгая валидация**: Обязательная проверка перед использованием
- ✅ **Плейсхолдеры**: Параметризация для переиспользования шаблонов
- ✅ **Версионирование**: Поддержка истории изменений и обратной совместимости
- ✅ **Документирование**: Каждый промпт содержит мета-информацию
- ✅ **Интеграция с CI**: Автоматическая валидация в pipeline
- ✅ **Русский язык**: Все промпты на русском для согласованности с проектом

---

## Полный шаблон промпта / Full Prompt Template

### Структура YAML файла

Используйте следующую структуру для создания файлов промптов (`.yaml` или `.yml`):

```yaml
# Мета-информация промпта
prompt:
  version: "1.0"
  name: "Название задачи агента"
  description: "Краткое описание назначения промпта"
  author: "Имя автора"
  created_date: "2025-11-14"
  last_modified: "2025-11-14"
  
# Режим валидации
validation:
  strict_mode: true  # true = строгая проверка всех параметров
  required_parameters:
    - "task_description"
    - "acceptance_criteria"
  optional_parameters:
    - "context"
    - "constraints"
    
# Параметры промпта (плейсхолдеры)
parameters:
  task_description: "{{TASK_DESCRIPTION}}"
  context: "{{CONTEXT}}"
  acceptance_criteria: "{{ACCEPTANCE_CRITERIA}}"
  constraints: "{{CONSTRAINTS}}"
  reference_files:
    - "{{REFERENCE_FILE_1}}"
    - "{{REFERENCE_FILE_2}}"

# Основной текст промпта
content: |
  # Задача: {{TASK_DESCRIPTION}}
  
  ## Контекст / Context
  {{CONTEXT}}
  
  ## Цель / Goal
  {{TASK_DESCRIPTION}}
  
  ## Требования / Requirements
  {{ACCEPTANCE_CRITERIA}}
  
  ## Ограничения / Constraints
  {{CONSTRAINTS}}
  
  ## Применимые Принципы / Applicable Principles
  Следуй 8 принципам проекта из [8_CORE_PRINCIPLES.md](docs/8_CORE_PRINCIPLES.md):
  - [ ] **Принцип 1**: Немедленная работоспособность
  - [ ] **Принцип 2**: Независимость и согласование
  - [ ] **Принцип 3**: Строгое соответствие ТЗ
  - [ ] **Принцип 4**: Единый план разработки
  - [ ] **Принцип 5**: Отдельная директория для отчетов
  - [ ] **Принцип 6**: UI + Assets при реализации
  - [ ] **Принцип 7**: Разветвленная структура
  - [ ] **Принцип 8**: Отражение в Progress
  
  ## Файлы для обращения / Files to Reference
  {{REFERENCE_FILE_1}}
  {{REFERENCE_FILE_2}}
  
  ## Критерии приемки / Acceptance Criteria
  {{ACCEPTANCE_CRITERIA}}
  
  ## Дополнительные замечания / Additional Notes
  {{CONSTRAINTS}}

# Примеры использования
examples:
  - name: "Пример 1: Создание новой фичи"
    parameters:
      task_description: "Реализовать систему инвентаря"
      context: "Игра требует систему управления предметами"
      acceptance_criteria: "- [ ] Инвентарь отображается в UI\\n- [ ] Предметы можно добавлять/удалять"
      constraints: "Максимум 20 слотов, без drag-and-drop"
```

### Пример Markdown промпта (OpenAI-стиль)

Для промптов, которые будут использоваться напрямую с API OpenAI или аналогичными:

```markdown
---
version: 1.0
name: Реализация игровой механики
strict_mode: true
required_params: [task_name, requirements]
---

# Системный промпт для агента разработки

Ты - опытный разработчик на C++ и SFML, работающий над проектом Road Trip Adventure RPG.

## Твоя задача
{{TASK_NAME}}

## Контекст проекта
- Проект: Road Trip Adventure RPG (дорожное приключение, Россия 90-х)
- Стиль игры: Keep Driving (пошаговые события, управление ресурсами)
- UI стиль: Fallout 4 terminals (моноширинный шрифт, постепенная печать)
- Технологии: C++17, SFML 2.5+, CMake 3.10+

## Требования к реализации
{{REQUIREMENTS}}

## Обязательные принципы
Следуй 8 принципам разработки проекта:

1. **Немедленная работоспособность** - код работает сразу, без заглушек
2. **Независимость и согласование** - только утвержденные зависимости
3. **Строгое соответствие ТЗ** - никаких "улучшений" без согласования
4. **Единый план разработки** - следуй плану, без экспериментов
5. **Отдельная директория для отчетов** - все отчеты в docs/progress/
6. **UI + Assets при реализации** - UI сразу, не откладывая
7. **Разветвленная структура** - модульная архитектура
8. **Отражение в Progress** - обновляй docs/progress.md

## Критерии приемки
- [ ] Код компилируется без предупреждений
- [ ] Все функции работают согласно требованиям
- [ ] Нет TODO/FIXME комментариев
- [ ] Документация обновлена
- [ ] Тесты написаны и проходят

## Формат ответа
1. Анализ задачи
2. План реализации (список шагов)
3. Код с комментариями
4. Инструкции по интеграции
5. Обновленная документация

{{ADDITIONAL_CONTEXT}}
```

### Пример использования плейсхолдеров

Плейсхолдеры в фигурных скобках `{{PLACEHOLDER}}` заменяются на реальные значения при рендеринге:

```yaml
# Определение параметров
parameters:
  feature_name: "Система диалогов"
  priority: "высокий"
  deadline: "2025-11-20"

# Использование в тексте
content: |
  Реализуй {{feature_name}} с приоритетом {{priority}}.
  Дедлайн: {{deadline}}.
```

Результат после рендеринга:
```
Реализуй Система диалогов с приоритетом высокий.
Дедлайн: 2025-11-20.
```

---

## Как использовать этот шаблон / How to Use

### Для создания нового промпта:

1. **Скопируйте YAML шаблон** из раздела выше
2. **Заполните мета-информацию**:
   - `version` - номер версии (следуйте SemVer)
   - `name` - краткое название задачи
   - `description` - одно предложение о назначении
   - `author` - ваше имя или ник
   - `created_date` и `last_modified` - даты в формате YYYY-MM-DD

3. **Настройте валидацию**:
   - `strict_mode: true` для критических промптов
   - Укажите обязательные параметры в `required_parameters`
   - Опциональные параметры в `optional_parameters`

4. **Определите параметры**:
   - Используйте плейсхолдеры в формате `{{PARAMETER_NAME}}`
   - Все параметры в UPPER_CASE
   - Документируйте каждый параметр

5. **Напишите содержимое**:
   - Используйте разделы из шаблона
   - Следуйте структуре: Контекст → Цель → Требования → Критерии
   - Включайте ссылки на 8_CORE_PRINCIPLES.md

6. **Добавьте примеры**:
   - Минимум 1 пример использования
   - Показывайте реальные значения параметров

### Для использования промпта:

```bash
# Валидация промпта перед использованием
./scripts/validate_prompt.sh prompts/my_prompt.yaml

# Рендеринг промпта с параметрами
./scripts/render_prompt.sh prompts/my_prompt.yaml \
  --param TASK_DESCRIPTION="Создать HUD панель" \
  --param CONTEXT="Stage 2 реализации" \
  --param ACCEPTANCE_CRITERIA="3 секции HUD"

# Передача в агента
cat prompts/my_prompt.yaml | ai-agent --config agent.yaml
```

### Для интеграции с CI:

Добавьте в `.github/workflows/validate-prompts.yml`:

```yaml
name: Validate Prompts
on: [push, pull_request]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Validate all prompts
        run: |
          for file in prompts/*.yaml; do
            ./scripts/validate_prompt.sh "$file"
          done
```

---

## Правила редактирования / Editing Rules

### Для мейнтейнеров:

1. **Версионирование**:
   - Изменение структуры → major version bump (1.0 → 2.0)
   - Добавление полей → minor version bump (1.0 → 1.1)
   - Исправление опечаток → patch version bump (1.0.0 → 1.0.1)

2. **Обратная совместимость**:
   - Не удаляйте существующие обязательные параметры
   - Новые обязательные параметры → major version
   - Новые опциональные параметры → minor version
   - Всегда предоставляйте значения по умолчанию

3. **Документирование изменений**:
   - Обновляйте `last_modified` дату
   - Добавляйте запись в раздел "История изменений"
   - Описывайте breaking changes

### Для контрибьюторов:

1. **Перед изменением существующего промпта**:
   - Проверьте, используется ли он в CI
   - Найдите все места использования (`grep -r "prompt_name"`)
   - Согласуйте breaking changes с мейнтейнерами

2. **При создании нового промпта**:
   - Следуйте этому шаблону
   - Включайте минимум 1 рабочий пример
   - Добавляйте валидацию для всех параметров
   - Тестируйте промпт перед коммитом

3. **Именование файлов**:
   - Используйте snake_case: `feature_implementation.yaml`
   - Префиксы по типу: `task_`, `agent_`, `validation_`
   - Примеры: `task_create_hud.yaml`, `agent_code_review.yaml`

---

## Обслуживание и обратная совместимость / Maintenance

### Жизненный цикл промпта

1. **Draft** (черновик):
   - Версия 0.x.x
   - Может содержать incomplete секции
   - Используется только для разработки

2. **Stable** (стабильный):
   - Версия 1.0.0+
   - Полностью задокументирован
   - Протестирован на реальных задачах
   - Готов к использованию в production

3. **Deprecated** (устаревший):
   - Помечен как `deprecated: true` в YAML
   - Период deprecation минимум 1 месяц
   - Документация указывает альтернативу

4. **Retired** (выведен из эксплуатации):
   - Перемещен в `prompts/archived/`
   - Не используется в активной разработке
   - Сохраняется для истории

### Обратная совместимость

**Гарантии для stable промптов (1.0.0+):**

- ✅ Добавление новых optional параметров - совместимо
- ✅ Добавление новых секций в content - совместимо
- ✅ Улучшение примеров - совместимо
- ❌ Удаление required параметров - **несовместимо**
- ❌ Изменение типа параметра - **несовместимо**
- ❌ Изменение структуры validation - **несовместимо**

**При breaking changes:**
1. Создайте новую версию промпта с новым major version
2. Пометьте старую версию как deprecated
3. Обновите документацию с migration guide
4. Дайте minimum 1 месяц на переход

### Политика deprecation

```yaml
# Пример deprecated промпта
prompt:
  version: "1.5.0"
  name: "Старая система задач"
  deprecated: true
  deprecated_date: "2025-11-01"
  replacement: "task_system_v2.yaml"
  deprecation_reason: "Заменен на более гибкую систему параметров"
  end_of_life: "2025-12-01"
```

---

## Перекрестные ссылки / Cross-References

### Документация проекта

- **[8_CORE_PRINCIPLES.md](docs/8_CORE_PRINCIPLES.md)** - 8 принципов разработки (обязательно к прочтению)
- **[progress.md](docs/progress.md)** - Текущий статус реализации проекта
- **[tasks.md](docs/tasks.md)** - Консолидированные задачи и user stories
- **[task-tech.md](docs/task-tech.md)** - Технические спецификации задач
- **[tech.md](docs/tech.md)** - Архитектура игры
- **[PROMPT_TEMPLATE.md](docs/PROMPT_TEMPLATE.md)** - Существующий шаблон задач (в docs/)

### Примеры промптов

Примеры реальных промптов для агентов можно найти в:
- `docs/PROMPT_TEMPLATE.md` - Примеры задач для агентов разработки
- `docs/task-tech/TEMPLATE.md` - Шаблон технических спецификаций
- Используйте эти файлы как референс для создания новых промптов

### CI/CD конфигурации

Если в проекте используются GitHub Actions или другие CI системы:
- `.github/workflows/` - Автоматизация валидации промптов
- `.github/PULL_REQUEST_TEMPLATE.md` - Шаблон PR с чеклистами

### Скрипты валидации

Создайте скрипты для автоматической проверки:
- `scripts/validate_prompt.sh` - Валидация YAML структуры
- `scripts/render_prompt.sh` - Рендеринг промпта с параметрами
- `scripts/lint_prompts.sh` - Проверка стиля и соответствия стандартам

---

## История изменений / Changelog

### Version 1.0.0 - 2025-11-14

**Добавлено:**
- ✅ Инициальная версия шаблона промптов
- ✅ Структура YAML для промпт-файлов
- ✅ Примеры Markdown промптов (OpenAI-стиль)
- ✅ Система плейсхолдеров и параметров
- ✅ Правила валидации (strict mode)
- ✅ Руководство по использованию и редактированию
- ✅ Политика версионирования и обратной совместимости
- ✅ Жизненный цикл промптов (draft → stable → deprecated → retired)
- ✅ Перекрестные ссылки на документацию проекта
- ✅ Интеграция с CI/CD pipeline

**Контекст:**
- PR: [add-prompt-template-md]
- Автор: GitHub Copilot Agent
- Цель: Стандартизация промптов для пользовательских агентов
- Мотивация: Снижение ошибок, упрощение тестирования, единообразие

**Примечания:**
- Все промпты должны быть на русском языке
- Следовать 8 принципам проекта из 8_CORE_PRINCIPLES.md
- Использовать строгую валидацию для критических промптов
- Документировать все изменения в этом файле

---

## Контрольный список / Checklist

При создании нового промпта убедитесь:

- [ ] Заполнена вся мета-информация (version, name, description, author, dates)
- [ ] Настроена валидация (strict_mode, required/optional parameters)
- [ ] Все параметры задокументированы и используют плейсхолдеры
- [ ] Структура следует шаблону (Контекст → Цель → Требования → Критерии)
- [ ] Включены ссылки на 8_CORE_PRINCIPLES.md
- [ ] Добавлен минимум 1 рабочий пример
- [ ] Промпт протестирован с реальными значениями параметров
- [ ] Файл назван согласно конвенции (snake_case, с префиксом)
- [ ] Добавлена запись в историю изменений
- [ ] Промпт валидируется скриптом validate_prompt.sh

---

**Последнее обновление:** 2025-11-14  
**Версия документа:** 1.0.0  
**Статус:** Активный / Active  
**Мейнтейнер:** Команда разработки Road Trip Adventure RPG
